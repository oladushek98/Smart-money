const csrftoken=$('input[name="csrfmiddlewaretoken"]').attr("value");let header=new Headers;async function getTransactionSourse(){try{let e=await fetch("api/transaction/getsourse",{method:"GET",headers:header,credentials:"same-origin"}),t=await e.json(),n={status:e.status,body:t.body},o=!1;0==n.body.length&&(btn_add[0].setAttribute("disabled",!1),source_select[0].setAttribute("disabled",!1),n.body=[{id:-1,name:"нет источника"}],o=!0);let a=null;for(source_select.children().remove(),i=0;i<n.body.length;i++)(a=document.createElement("option")).setAttribute("value",n.body[i].id),a.textContent=n.body[i].name,source_select.append(a);return!o&&(source_select[0].removeAttribute("disabled"),btn_add[0].removeAttribute("disabled"),!0)}catch(e){console.log(e)}}async function getTransactionDestination(e){if(void 0===e)return!1;try{let t=await fetch("api/transaction/getdest/"+e,{method:"GET",headers:header,credentials:"same-origin"}),n=await t.json(),o={status:t.status,body:n.body},a=!1;0==o.body.length&&(btn_add[0].setAttribute("disabled",!1),destination_select[0].setAttribute("disabled",!1),o.body=[{id:-1,name:"нет пункта назначения"}],a=!0);let r=null;for(destination_select.children().remove(),i=0;i<o.body.length;i++)(r=document.createElement("option")).setAttribute("value",o.body[i].id),r.textContent=o.body[i].name,destination_select.append(r);return!a&&(destination_select[0].removeAttribute("disabled"),btn_add[0].removeAttribute("disabled"),!0)}catch(e){console.log(e)}}async function createTransaction(e){const t=await fetch("api/transaction/create",{method:"PUT",body:JSON.stringify(e),headers:header,credentials:"same-origin"});return await t.json()}function compareCur(){try{let e=source_select.val().split("/")[0],t=destination_select.val().split("/")[0];if(e!==t){console.log(e," -> ",t),cur_choice_container[0].setAttribute("style","display: block;");let n=document.createElement("option");n.setAttribute("value",e),n.textContent=e,currency.children().remove(),currency.append(n),(n=document.createElement("option")).setAttribute("value",t),n.textContent=t,currency.append(n)}else console.log(e," -> ",t),cur_choice_container[0].setAttribute("style","display: none;")}catch(e){console.log(e)}}function updateAmount(e,t,n){switch(e.split("_")[0]){case"income":return updateIncomeAmount(e.split("_")[1],t,n);case"account":return updateAccountAmount(e.split("_")[1],t,n);case"cost":return updateCostAmount(e.split("_")[1],t,n)}}function updateIncomeAmount(e,t,n){let i,o=$("#finNode_"+e),a=o.parent().children()[2].children[0].textContent;i=+a.split(" ")[1]+ +t;let r=a.split(" ")[0]+" "+i;o.parent().children()[2].children[0].textContent=r}function updateAccountAmount(e,t,n){let i,o=$("#finNode_"+e),a=o.parent().children()[2].children[0].textContent;i=n?+a.split(" ")[1]-+t:+a.split(" ")[1]+ +t;let r=a.split(" ")[0]+" "+i;o.parent().children()[2].children[0].textContent=r}function updateCostAmount(e,t,n){let i=$("#finNode_"+e),o=i.parent().children()[2].children[0].textContent,a=+o.split(" ")[1]+ +t,r=o.split(" ")[0]+" "+a;i.parent().children()[2].children[0].textContent=r}async function deleteTransaction(e){const t=await fetch("api/transaction/delete",{method:"PUT",body:JSON.stringify({id:e}),headers:header,credentials:"same-origin"});return await t.json()}header.append("X-CSRFToken",csrftoken);