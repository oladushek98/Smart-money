{% load static %}


<script src="{% static 'main/scripts/api/transactionApi.js' %}"></script>
<div class="sm-dashboard-top">
    <div class="add-transaction_wrapper">
        <div class="add-transaction sm-add-transaction_state_standby">
            <span id="add-transaction_placeholder"
                  class="add-transaction_text add-transaction_placeholder">
                из Кошелька в Продукты 1000 ₽ 12.04.2019 #метка комментарий
            </span>
            <div id="steps" class="transaction-steps">
                <div id="step_1" class="add-transaction_step">
                    <span>из </span>
                    {{ ADD_TRANSACTION_FORM.transaction_from }}
                </div>
                <div id="step_2" class="add-transaction_step">
                    <span>в </span>
                    {{ ADD_TRANSACTION_FORM.transaction_to }}
                </div>
                <div id="step_3" class="add-transaction_step">
                    <span>сколько: </span>
                    {{ ADD_TRANSACTION_FORM.amount }}
                </div>
                <div id="choice" class="add-transaction_step">
                    {{ ADD_TRANSACTION_FORM.choice_currency }}
                </div>
                <div id="step_4" class="add-transaction_step">
                    <span style="margin-left: 10px;">дата: </span>
                    {#                    {{ ADD_TRANSACTION_FORM.data_from }}#}
                    <input id="id_date" type="text" class="datepicker">
                </div>
            </div>
        </div>

        <button id="add" disabled
                class="sm-add-transaction_submit {{ button_color }}"></button>
    </div>
</div>


<script>

    const btn_add = $('#add');
    btn_add[0].setAttribute("disabled", false);

    let fade = document.createElement('div');

    fade.setAttribute('class', 'sm-fade');

    const wrapper = $('.add-transaction_wrapper');
    wrapper.append(fade, wrapper.children()[0]);
    wrapper.children()[0].remove();
    const add_transaction_container = $('.add-transaction');

    const step_1 = $('#steps');

    const source_select = $('#id_transaction_from');
    const destination_select = $('#id_transaction_to');
    const currency = $('#id_choice_currency');
    const cur_choice_container = $('#choice');
    cur_choice_container[0].setAttribute('style', 'display: none;');

    getTransactionSourse();
    $('#id_amount').val(100);

    btn_add.on('click', async (event) => {
        let body = {
            transaction_from: $('#id_transaction_from').val().split('/')[1],
            transaction_to: $('#id_transaction_to').val().split('/')[1],
            amount: $('#id_amount').val(),
            date: datepicker.val(),
        };
        res = await createTransaction(body);
        if (res.ok) {
            addNewTransaction(res.body.id,
                res.body.transaction_from,
                res.body.transaction_to,
                res.body.amount,
                res.body.date);
            $('#add')[0].setAttribute("disabled", false);
            fade.remove();
            step_1.remove();
            add_transaction_container.append(span, btn_add);
        }

        console.log(res)
    });

    const date = new Date();
    const datepicker = $('.datepicker');
    datepicker.datepicker({
        autoClose: true,
        format: 'd.m.yyyy',
        defaultDate: date,
        setDefaultDate: true,
    });

    fade.remove();
    step_1.remove();

    const span = $('#add-transaction_placeholder');


    destination_select.on('click', (event) => {
        compareCur();
    });
    add_transaction_container.on('click', (event) => {
        if (add_transaction_container.children()[0] == span[0]) {
            wrapper.append(fade, wrapper.children()[0]);
            span.remove();
            add_transaction_container.append(step_1, btn_add);
            btn_add.removeAttr('disabled');
            source_select.on('click', (event) => {
                getTransactionDestination(event.target.value.split('/')[1]);
                compareCur();
            });
        }
    });


    window.onclick = function (event) {
        if (event.target == fade) {
            $('#add')[0].setAttribute("disabled", false);
            fade.remove();
            step_1.remove();
            add_transaction_container.append(span, btn_add);
            compareCur();
        }
    };

    $(document).ready(function () {
        add_transaction_container.append(span, btn_add);
        getTransactionDestination('1');
    });


</script>