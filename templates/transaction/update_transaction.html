{% extends 'base.html' %}

{% block content %}
    <div class="sm-dashboard">
        <div class="sm-dashboard-body">
            <div class="sm-dashboard-column">
                <div class="sm-update-form z-depth-1">
                    {% include 'forms/update_delete_form_income.html' %}
                </div>
            </div>
            <div class="sm-dashboard-column">
                <canvas id="myChart" width="400" height="400"></canvas>
            </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('myChart');
        let data = '{{ data }}';
        data = data.replace(/&#39;/g, '"');
        data = JSON.parse(data);
        let myPieChart = new Chart(ctx, {
            type: 'pie',
            data: data,
            options: {}
        });
    </script>
{% endblock %}

{% block scrypt %}
    $(document).ready(function(){
    $('.modal').modal();
    let f = (e) => { e.setAttribute('readonly', true);
    e.removeAttribute('disabled') };
    let s = $('input[disabled]');
    s.get().forEach(f);
    });

    let deleteNode = async (id, flag) => {
    const body = {
    'id': id,
    };

    const csrftoken = $('input[name="csrfmiddlewaretoken"]').attr('value');
    let header = new Headers();
    header.append('X-CSRFToken', csrftoken);

    let response = await fetch('{% url 'delete_transaction' %}',
    {
    method: 'PUT',
    body: JSON.stringify(body),
    headers: header,
    credentials: 'same-origin'
    }
    );

    if(response.ok){
    window.location.href = 'http://localhost:8000/user'
    }
    }
{% endblock %}